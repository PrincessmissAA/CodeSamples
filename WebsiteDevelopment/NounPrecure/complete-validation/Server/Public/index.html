<!doctype html>
<html>

<head>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>GIMM 285 Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
</head>

<body>
    <h1>Precure character Personnality</h1>

    <hr />
    <!-- I used chatGPT for the name form elements -->
    <div class='row'>
        <div class='col-2'>
            <label for="userName">Your Name:</label>
        </div>
        <div class='col-10'>
            <label for="myName">Cure </label>
            <input type="text" id="userName" name="userName" placeholder="Enter your name" required>
        </div>
    </div>


    <div class='row'>
        <div class='col-2'>
            <label>Personnality Type</label>

        </div>
        <div class='col-10'>

            <label for="Personnality">Choose a personality type</label>
            <select id="Personality" name="Personality">
                <option value="Energetic">Energetic</option>
                <option value="Smart">Smart</option>
                <option value="Outgoing">Outgoing</option>
                <option value="Cool">Cool</option>
                <option value="Fiery">Fiery</option>
            </select>
        </div>
    </div>

    <div class='row'>
        <div class='col-2'>
            <label>Theme</label>

        </div>
        <div class='col-10'>
            <label for="Theme">Theme:</label><br>
            <input type="text" id="Theme" name="Theme" value=""><br>
            <label for="STheme">Sub Theme:</label><br>
            <input type="text" id="STheme" name="STheme" value=""><br><br>
        </div>
    </div>

    <div class='row'>
        <div class='col-2'>
            <label>Picture Upload</label>

        </div>
        <div class='col-10'>

            <label for="PictureUpload">Picture Upload</label>
            <label for="myCard">Select a file:</label>
            <input type="file" id="PrecurePhoto" name="PrecurePhoto">
        </div>
    </div>
    <!-- I used ChatGPT for the hairstyle, number of teammates, color picker form elements -->
    <div class='row'>
        <div class='col-2'>
            <label>Hairstyle</label>
        </div>
        <div class='col-10'>
            <label><input type="radio" name="hairstyle" value="Short"> Short</label>
            <label><input type="radio" name="hairstyle" value="Medium"> Medium</label>
            <label><input type="radio" name="hairstyle" value="Long"> Long</label>
        </div>
    </div>

    <div class='row'>
        <div class='col-2'>
            <label>Number of Teammates</label>
        </div>
        <div class='col-10'>
            <label for="numTeammates">Enter number of teammates:</label>
            <input type="number" id="numTeammates" name="numTeammates" min="1" max="10">
        </div>
    </div>

    <div class='row'>
        <div class='col-2'>
            <label for="colorPicker">Pick Your Precure Color:</label>
        </div>
        <div class='col-10'>
            <input type="color" id="colorPicker" name="colorPicker" value="#ff66b2">
        </div>
    </div>


    <div class='row'>
        <div class='col-12'>
            <button id='submit'>Submit</button>
        </div>
    </div>

    <div id="successBanner" style="display:none;"></div>

    <h2>Previous Submissions</h2>
    <table id="submissionsTable" border="1">
        <thead>
            <tr>
                <th>Name</th>
                <th>Personality</th>
                <th>Theme</th>
                <th>Sub Theme</th>
                <th>Number of Teammates</th>
                <th>Hairstyle</th>
                <th>Color</th>
                <th>Uploaded File</th>
            </tr>
        </thead>
        <tbody id="submissionsBody">
        </tbody>
    </table>


    <hr />

    <script>
        //Hide banner at start of script
        const errorBanner = document.getElementById('invalid-form');
        errorBanner.hidden = true;
    
        //Click event handler
        document.getElementById('submit').addEventListener('click', () => {
            const fileField = document.querySelector('input[type="file"]');
            const checkedChoiceButton = document.querySelector('input[name="choice"]:checked');
    
            //Build form data object to send in request to server
            const formData = new FormData();
            formData.append('name', document.getElementById('name').value);
            formData.append('choice', null !== checkedChoiceButton ? checkedChoiceButton.value : '');
            formData.append('file', fileField.files[0]);
    
            //Settings for FETCH API request
            let fetchSettings = {
                method: 'POST',
                body: formData
            };
    
            //Send FETCH API request
            fetch("http://localhost/", fetchSettings)
                .then((response) => {
                    return new Promise((resolve) => response.json()
                        .then((json) => resolve({
                            status: response.status,
                            json,
                        })
                    ));
                })
                //Logic to display errors on form 
                .then(({ status, json }) => {
                    const errorMessages = document.getElementsByClassName('text-danger');
                    errorBanner.hidden = true;
                    for (htmlElement of errorMessages) {
                        htmlElement.innerHTML = '&nbsp;';
                    }
                    if (status === 400) {
                        errorBanner.innerText = 'Form has errors. Please correct them and resubmit.';
                        errorBanner.hidden = false;
                        for (error of json.errors) {
                            const errorId = error.path + '-error';
                            document.getElementById(errorId).innerHTML = error.msg
                        }
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            return;
        })
    </script>
</body>


</html>
