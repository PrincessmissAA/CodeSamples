<!doctype html>
<html>

<head>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Precure Survey Edit</title>
    <link rel='stylesheet' href='style.css'>
</head>

<body>
    <h1>Precure Character Personality</h1>

    <hr />

    <div class='row'>
        <div class='col-2'>
            <label for="name">Your Name:</label>
        </div>
        <div class='col-10'>
            <input type="text" id="name" name="name" placeholder="Enter your name" required>
        </div>
    </div>

    <div class='row'>
        <div class='col-2'>
            <label>Personality Type</label>
        </div>
        <div class='col-10'>
            <select id="personnality" name="personnality">
                <option value="Energetic">Energetic</option>
                <option value="Smart">Smart</option>
                <option value="Outgoing">Outgoing</option>
                <option value="Cool">Cool</option>
                <option value="Fiery">Fiery</option>
            </select>
        </div>
    </div>

    <div class='row'>
        <div class='col-2'>
            <label>Theme</label>
        </div>
        <div class='col-10'>
            <input type="text" id="theme" name="theme" value="">
            <br>
            <label for="stheme">Sub Theme:</label><br>
            <input type="text" id="stheme" name="stheme" value="">
            <br><br>
        </div>
    </div>

    <div class='row'>
        <div class='col-2'>
            <label>Number of Teammates</label>
        </div>
        <div class='col-10'>
            <input type="number" id="num_teammates" name="num_teammates" min="1" max="10">
        </div>
    </div>

    <div class='row'>
        <div class='col-2'>
            <label>Hairstyle</label>
        </div>
        <div class='col-10'>
            <label><input type="radio" name="hairstyle" value="Short"> Short</label>
            <label><input type="radio" name="hairstyle" value="Medium"> Medium</label>
            <label><input type="radio" name="hairstyle" value="Long"> Long</label>
        </div>
    </div>

    <div class='row'>
        <div class='col-12'>
            <button id='search'>Save Changes</button>
        </div>
    </div>

    <hr />

    <script>
        const paramsString = window.location.search;
        const searchParams = new URLSearchParams(paramsString);

        fetch("/survey/" + searchParams.get('id'), { method: 'GET' })
            .then((response) => response.json())
            .then(({ status, json }) => {
                if (200 === status || json.data) {
                    let row = json.data[0];
                    document.getElementById('name').value = row.name;
                    document.getElementById('personnality').value = row.personnality;
                    document.getElementById('theme').value = row.theme;
                    document.getElementById('stheme').value = row.stheme;
                    document.getElementById('num_teammates').value = row.num_teammates;
                    const hairstyleOptions = document.getElementsByName('hairstyle');
                    for (let option of hairstyleOptions) {
                        if (option.value === row.hairstyle) {
                            option.checked = true;
                            break;
                        }
                    }
                }
            })
            .catch(error => console.error('Error:', error));

        document.getElementById('search').addEventListener('click', (event) => {
            const formData = new FormData();

            formData.append('name', document.getElementById('name').value);
            formData.append('personnality', document.getElementById('personnality').value);
            formData.append('theme', document.getElementById('theme').value);
            formData.append('stheme', document.getElementById('stheme').value);
            formData.append('num_teammates', document.getElementById('num_teammates').value);
            const hairstyle = document.querySelector('input[name="hairstyle"]:checked');
            formData.append('hairstyle', hairstyle ? hairstyle.value : '');

            let fetchSettings = {
                method: 'PUT',
                body: formData
            };

            fetch("/Precure/" + searchParams.get('id'), fetchSettings)
                .then((response) => response.json())
                .then(({ status, json }) => {
                    if (status === 200) {
                        alert('✨ Changes saved successfully! ✨');
                    } else {
                        alert('⚠️ There was a problem saving changes. ⚠️');
                    }
                })
                .catch(error => console.error('Error:', error));
        });
    </script>

</body>

</html>
