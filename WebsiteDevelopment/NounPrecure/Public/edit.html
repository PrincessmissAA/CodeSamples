<!doctype html>
<html>

<head>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Precure Survey Edit</title>
    <link rel='stylesheet' href='style.css'>
</head>

<body>
    <h1>Precure Character Personality</h1>

    <hr />

    <div class='row'>
        <div class='col-2'>
            <label for="name">Your Name:</label>
        </div>
        <div class='col-10'>
            <input type="text" id="name" name="name" placeholder="Enter your name" required>
        </div>
    </div>

    <div class='row'>
        <div class='col-2'>
            <label>season</label>
        </div>
        <div class='col-10'>
            <label for="season">Choose a season</label>
            <select id="season" name="season">
                <option value="futari_wa">futari wa</option>
                <option value="futari_wa_max_heart">futari wa max heart</option>
                <option value="splash_star">splash star</option>
                <option value="yes_precure_5_gogo">yes precure 5 gogo</option>
                <option value="fresh">fresh</option>
                <option value="heartcatch">heartcatch</option>
                <option value="suite">suite</option>
                <option value="smile">smile</option>
                <option value="doki_doki">doki doki</option>
                <option value="happiness_charge">happiness charge</option>
                <option value="go_princess">go princess</option>
                <option value="maho_tsukai">maho tsukai</option>
                <option value="kira_kira">kira kira precure a la mode</option>
                <option value="hugtto">hugtto</option>
                <option value="star_twinkle">star twinkle</option>
                <option value="healin_good">healin' good</option>
                <option value="tropical_rouge">tropical rouge</option>
                <option value="delicious_party">delicious party</option>
                <option value="hero_girl_sky">hero girl sky</option>
                <option value="wonderful">wonderful</option>
                <option value="kimi_to_idol">you and idol</option>
                <option value="movie_specific">movie specific</option>
            </select>
            <div id="season-error" class="text-danger"></div>
        </div>
    </div>

    <div class='row'>
        <div class='col-2'>
            <label>Theme</label>
        </div>
        <div class='col-10'>
            <input type="text" id="theme" name="theme" value="">
            <br>
            <label for="stheme">Sub Theme:</label><br>
            <input type="text" id="stheme" name="stheme" value="">
            <br><br>
        </div>
    </div>

    <div class='row'>
        <div class='col-2'>
            <label>Number of Teammates</label>
        </div>
        <div class='col-10'>
            <input type="number" id="num_teammates" name="num_teammates" min="1" max="10">
        </div>
    </div>

    <div class='row'>
        <div class='col-2'>
            <label>Hairstyle</label>
        </div>
        <div class='col-10'>
            <label><input type="radio" name="hairstyle" value="Short"> Short</label>
            <label><input type="radio" name="hairstyle" value="Medium"> Medium</label>
            <label><input type="radio" name="hairstyle" value="Long"> Long</label>
        </div>
    </div>

    <div class='row'>
        <div class='col-12'>
            <button id='search'>Save Changes</button>
        </div>
    </div>

    <div id="successBanner" hidden></div>
    <div id="invalid-form" class="text-danger" hidden></div>


    <hr />

    <script>
        const paramsString = window.location.search;
        const searchParams = new URLSearchParams(paramsString);

        fetch("/survey/" + searchParams.get('id'), { method: 'GET' })
            .then((response) => response.json())
            .then((json) => {
                if (json.data && json.data.length > 0) {
                    let row = json.data[0];
                    document.getElementById('name').value = row.name;
                    document.getElementById('season').value = row.season;
                    document.getElementById('theme').value = row.theme;
                    document.getElementById('stheme').value = row.stheme;
                    document.getElementById('num_teammates').value = row.num_teammates;
                    const hairstyleOptions = document.getElementsByName('hairstyle');
                    for (let option of hairstyleOptions) {
                        if (option.value === row.hairstyle) {
                            option.checked = true;
                            break;
                        }
                    }
                } else {
                    console.error('No record found! ✨ Maybe the ID is missing or incorrect.');
                }
            })


        document.getElementById('search').addEventListener('click', (event) => {
            const updatedData = {
                name: document.getElementById('name').value,
                season: document.getElementById('season').value,
                theme: document.getElementById('theme').value,
                stheme: document.getElementById('stheme').value,
                num_teammates: parseInt(document.getElementById('num_teammates').value),
                hairstyle: document.querySelector('input[name="hairstyle"]:checked')?.value || '',
                precure_photo: null // ✨ add this line ✨
            };

            let fetchSettings = {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(updatedData)
            };

            fetch("/Precure/" + searchParams.get('id'), fetchSettings)
                .then((response) => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('⚠️ There was a problem saving changes. ⚠️');
                    }
                })
                .then((json) => {
                    alert('✨ Changes saved successfully! ✨');
                })
                .catch(error => {
                    alert(error.message);
                    console.error('Error:', error);
                });

        });


    </script>

</body>

</html>